package com.lecongthuan.anothertest;

import androidx.appcompat.app.AppCompatActivity;

import android.app.Dialog;
import android.database.Cursor;
import android.database.sqlite.SQLiteDatabase;
import android.graphics.Color;
import android.graphics.drawable.ColorDrawable;
import android.os.Bundle;
import android.util.Log;
import android.view.Gravity;
import android.view.View;
import android.view.ViewGroup;
import android.widget.AdapterView;
import android.widget.Button;
import android.widget.EditText;

import com.lecongthuan.anothertest.Class.Product;
import com.lecongthuan.anothertest.adapter.ProductAdapter;
import com.lecongthuan.anothertest.databases.ProductDatabases;
import com.lecongthuan.anothertest.databinding.Cau2Binding;

import java.util.ArrayList;
import java.util.List;

public class Cau2 extends AppCompatActivity {
    Cau2Binding binding;
    ProductAdapter adapter;
    ArrayList<Product> products;
    ProductDatabases db;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        binding = Cau2Binding.inflate(getLayoutInflater());
        setContentView(binding.getRoot());


        db = new ProductDatabases(this);
        prepareDb();
        loadData();
        addEvent();

    }

    private void loadData() {
        adapter = new ProductAdapter(Cau2.this, R.layout.item_layout, getDataFromDb());
        binding.lvItem.setAdapter(adapter);
    }


    private List<Product> getDataFromDb() {
        products = new ArrayList<>();
        Cursor cursor = db.queryData("SELECT * FROM " + ProductDatabases.TBL_NAME);
        while (cursor.moveToNext()){
            products.add(new Product(cursor.getString(0),
                    cursor.getString(1),
                    cursor.getDouble(2)
            ));
        }
        cursor.close();
        return products;
    }

    private void prepareDb() {
        db = new ProductDatabases(Cau2.this);
        db.createSampleData();
    }

    private void addEvent() {
        binding.lvItem.setOnItemLongClickListener(new AdapterView.OnItemLongClickListener() {
            @Override
            public boolean onItemLongClick(AdapterView<?> parent, View view, int position, long id) {
                Dialog dialog = new Dialog(Cau2.this);
                dialog.setContentView(R.layout.diag_add);

                Button btnBack = dialog.findViewById(R.id.btnBack);
                EditText edtCode = dialog.findViewById(R.id.editCode);
                EditText edtName = dialog.findViewById(R.id.editName);
                EditText edtPrice = dialog.findViewById(R.id.editPrice);

                Button btnSave = dialog.findViewById(R.id.btnSave);
                Button btnDelete = dialog.findViewById(R.id.btnDelete);

                edtCode.setText(products.get(position).getProductCode());
                edtName.setText(products.get(position).getProductName());
                edtPrice.setText(String.valueOf(products.get(position).getProductPrice()));

                btnSave.setOnClickListener(new View.OnClickListener() {
                    @Override
                    public void onClick(View v) {
                        //Insert
                        String code = edtCode.getText().toString();
                        String name = edtName.getText().toString();
                        Double price = Double.valueOf(edtPrice.getText().toString());

                        db.execSql("INSERT INTO " + ProductDatabases.TBL_NAME + " VALUES('"+ code +"','" + name + "', " + price + ")");
                        loadData();
                        dialog.dismiss();
                    }
                });

                btnDelete.setOnClickListener(new View.OnClickListener() {
                    @Override
                    public void onClick(View v) {
                        //* db.execSql("DELETE FROM " + Database.TBL_NAME + " WHERE " + Database.COL_CODE + " = " + p.getbookCode());*//*
                        SQLiteDatabase db = Cau2.this.db.getWritableDatabase();
                        db.delete(ProductDatabases.TBL_NAME, ProductDatabases.COL_CODE + " = ?", new String[]{String.valueOf(products.get(position).getProductCode())});
                        loadData();
                        dialog.dismiss();
                    }
                });

                btnBack.setOnClickListener(new View.OnClickListener() {
                    @Override
                    public void onClick(View v) {
                        dialog.cancel();
                    }
                });

                // show dialog
                dialog.getWindow().setLayout(ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.WRAP_CONTENT);
                dialog.getWindow().setGravity(Gravity.CENTER);
                dialog.show();

                return true;
            }
        });
    }

}
